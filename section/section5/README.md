# 5. 카프카 실전 프로젝트
**프로젝트 개발환경**

- 카프카 클러스터
- openJDK 1.8
- Gradle

## 5.1 웹 페이지 이벤트 적재 파이프라인 생성

<img src="/img/5.1-1.png" width="1000px;">

웹 페이지 사용자 이벤트 수집은 서비스에 영향을 미치지 않으면서도 안정적으로 유지되어야 한다.</br>
이벤트 수집보다 서비스의 정상 동작이 우선되어야 한다.</br>
따라서 이벤트 수집 파이프라인과 서비스의 커플링을 최소화하고 확장성 높은 파이프라인을 만드는 것이 중요하다.</br>
카프카는 예상치 못한 데이터의 급격한 증가가 발생하더라도 안정적으로 운영하는 데에 강점이 있다.</br>
모든 이벤트는 카프카 토픽에 저장되기 때문에, 일단 쌓이면 컨슈머가 자신이 할 수 있는 양만큼 최종 적재 애플리케이션에 저장하면 되기 때문이다.</br>

해당 프로젝트는 웹 페이지에서 생성되는 이벤트들을 분석하기 위해 HDFS 와 엘라스틱서치에 적재하는 파이프라인을 만드는 것을 진행한다.

### 5.1.1 요구 사항

이름을 입력하고 자신이 좋아하는 색상을 고르는 버튼을 클릭하게되면 해당 이벤트와 유저 에이전트 정보를 카프카 토픽으로 전달하고 최종적으로 하둡과 엘라스틱서치에 적재되는 것을 목표로 한다.

### 5.1.2 정책 및 기능 정의

**적재 정책**

적재 파이프라인을 만들 때 가장 처음 결정해야 하는 것은 적재 정책이다.</br>
일부 데이터가 유실이나 중복 적재되어도 무관한 정책이라면 파이프라인의 운영 난이도는 낮아진다.</br>
반면, 데이터가 유실, 중복 없이 정확히 한번(exactly once) 적재되는 정책이라면 파이프라인 운영 난이도는 상당히 올라간다.</br>
정확히 한번 적재가 필요한 경우에는 멱등성 프로듀서를 사용하고 고유한 키를 지원하는 데이터베이스 시스템에 적재하는 것이 확실하다.</br>

예를 들어, RDBMS 인 MySQL 에 unique key 를 가진 테이블을 생성하고 해당 테이블에 insert 하는 적재 파이프라인을 만드는 경우, 컨슈머가 중복해서 insert를 시도하더라도 unique key 로 적재된 데이터가 존재하므로 중복 적재되지 않는다.

하지만 이번 프로젝트는 사용자 이벤트를 수집하는 경우이므로 아래와 같이 정책을 정의한다.

- 일부 데이터의 유실 또는 중복 허용
- 안정적으로 끊임없는 적재
- 갑작스럽게 발생하는 많은 데이터양을 허용